# https://circleci.com/docs/config-sample
machine:
  ruby:
    version: 2.1.3

  # Add some environment variables
  environment:
    CODECLIMATE_REPO_TOKEN: 38d34b549aa5f497773fa59be275e89b798631012dec08f21f0a9ca1c5cdffb9
    COVERALLS_REPO_TOKEN: RuKfM9BdUaOqw9wS99oePc8TNtsQFAiie

## Customize dependencies
dependencies:
  pre:
    - gem install paraduct --pre
    # - cp config/global/gemoire.yml{.example,}

## Customize database setup
database:
  override:
    # replace CircleCI's generated database.yml
    # - cp config/database.yml{.sqlite3,}
    # - RACK_ENV=test bundle exec rake ar:migrate:reset
    - echo "do nothing"

## Customize test commands
test:
  override:
    - paraduct test

## Customize deployment commands
deployment:
  production:
    branch: master
    commands:
      - heroku config:add BUNDLE_WITHOUT="test:development:sqlite3:mysql" --app gemoire
      - git push git@heroku.com:gemoire.git $CIRCLE_SHA1:refs/heads/master
      - heroku run rake ar:migrate --app gemoire:
          timeout: 400 # if your deploys take a long time
